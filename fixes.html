<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ryuu Online Fixes - Browser avec Recherche</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0f1419;
      --bg-secondary: #1a1f2e;
      --bg-tertiary: #252b3d;
      --bg-quaternary: #1e293b;
      --text-primary: #e2e8f0;
      --text-secondary: #94a3b8;
      --accent-primary: #6366f1;
      --accent-secondary: #4f46e5;
      --border-color: #334155;
      --border-hover: #475569;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      line-height: 1.6;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

    .header { margin-bottom: 16px; }
    .title { font-size: 24px; font-weight: 600; margin-bottom: 8px; }
    .subtitle { color: var(--text-secondary); font-size: 14px; }

    .controls {
      margin-top: 16px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .search {
      flex: 1 1 320px;
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-quaternary);
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
    }

    .search input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text-primary);
      font-size: 14px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      border: 1px solid var(--border-color);
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .btn:hover { border-color: var(--border-hover); background: var(--bg-secondary); }

    .meta { margin-left: auto; color: var(--text-secondary); font-size: 13px; }

    .grid {
      margin-top: 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      overflow: hidden;
    }

    .grid-inner {
      padding: 16px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 14px;
      max-height: 70vh;
      overflow: auto;
    }

    .card {
      display: block;
      padding: 14px;
      border-radius: 10px;
      border: 1px solid var(--border-color);
      text-decoration: none;
      color: var(--text-primary);
      background: var(--bg-quaternary);
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }

    .card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); border-color: var(--border-hover); }

    .card-name { font-size: 14px; font-weight: 600; margin-bottom: 8px; word-break: break-word; }
    .card-size { font-size: 12px; color: var(--text-secondary); }

    .empty { padding: 24px; text-align: center; color: var(--text-secondary); }

    .footer { margin-top: 16px; text-align: center; color: var(--text-secondary); font-size: 13px; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--border-hover); }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">Ryuu Online Fixes</div>
      <div class="subtitle">Liste auto-mise à jour avec barre de recherche</div>
      <div class="controls">
        <div class="search">
          <input id="search" type="text" placeholder="Rechercher un jeu (ex: \"Borderlands\")" autocomplete="off" />
        </div>
        <button id="refresh" class="btn">Rafraîchir</button>
        <div id="meta" class="meta">Chargement…</div>
      </div>
    </div>

    <div class="grid">
      <div id="grid" class="grid-inner"></div>
      <div id="empty" class="empty" style="display:none;">Aucun résultat</div>
    </div>

    <div id="fallback" style="display:none; margin-top: 16px;">
      <div class="subtitle" style="margin-bottom:8px;">
        Chargement bloqué par CORS. Affichage de la page source ci-dessous (recherche désactivée):
      </div>
      <iframe id="fallbackFrame" src="https://generator.ryuu.lol/fixes" style="width:100%; height:65vh; border:1px solid var(--border-color); border-radius: 8px; background: var(--bg-tertiary);"></iframe>
    </div>

    <div class="footer">Source directe: https://generator.ryuu.lol/fixes/</div>
  </div>

  <script>
    (function() {
      const SOURCE = 'https://generator.ryuu.lol/fixes/';

      /** @type {Array<{name:string, size:string|null, href:string}>} */
      let allItems = [];
      let visibleItems = [];

      const dom = {
        grid: document.getElementById('grid'),
        empty: document.getElementById('empty'),
        meta: document.getElementById('meta'),
        search: document.getElementById('search'),
        refresh: document.getElementById('refresh')
      };

      function decodeFileNameFromUrl(url) {
        try { return decodeURIComponent(url.split('/').pop() || url); } catch { return url; }
      }

      function render(items) {
        dom.grid.innerHTML = '';
        dom.empty.style.display = items.length ? 'none' : 'block';
        const frag = document.createDocumentFragment();
        for (const item of items) {
          const a = document.createElement('a');
          a.className = 'card';
          a.href = item.href;
          a.target = '_blank';
          const name = document.createElement('div');
          name.className = 'card-name';
          name.textContent = item.name;
          const size = document.createElement('div');
          size.className = 'card-size';
          size.textContent = item.size || '';
          a.appendChild(name);
          a.appendChild(size);
          frag.appendChild(a);
        }
        dom.grid.appendChild(frag);
        dom.meta.textContent = `${items.length} élément(s)`;
      }

      function applySearch() {
        const q = dom.search.value.trim().toLowerCase();
        if (!q) {
          visibleItems = allItems.slice();
        } else {
          visibleItems = allItems.filter(x => x.name.toLowerCase().includes(q));
        }
        render(visibleItems);
      }

      function debounce(fn, ms) {
        let t = null;
        return function(...args) {
          clearTimeout(t);
          t = setTimeout(() => fn.apply(this, args), ms);
        }
      }

      async function fetchHtmlDirect(url) {
        const resp = await fetch(url, { mode: 'cors' });
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        return await resp.text();
      }

      function parseFromGeneratorCards(htmlText, baseUrl) {
        const doc = new DOMParser().parseFromString(htmlText, 'text/html');
        const anchors = doc.querySelectorAll('.file-grid-content a.file-item');
        const items = [];
        anchors.forEach(a => {
          let href = a.getAttribute('href') || '';
          if (!/^https?:\/\//i.test(href)) {
            href = new URL(href, baseUrl).toString();
          }
          const nameEl = a.querySelector('.file-name');
          const sizeEl = a.querySelector('.file-size');
          const name = nameEl ? nameEl.textContent.trim() : decodeFileNameFromUrl(href);
          const size = sizeEl ? sizeEl.textContent.trim() : null;
          if (href && name) items.push({ name, size, href });
        });
        return items;
      }

      async function load() {
        dom.meta.textContent = 'Chargement…';
        try {
          const html = await fetchHtmlDirect(SOURCE);
          let items = parseFromGeneratorCards(html, SOURCE);
          // Nettoyage doublons et tri
          const seen = new Set();
          allItems = items.filter(x => {
            const key = x.href;
            if (seen.has(key)) return false;
            seen.add(key);
            return true;
          }).sort((a, b) => a.name.localeCompare(b.name, 'fr'));
          visibleItems = allItems.slice();
          applySearch();
        } catch (e) {
          console.error(e);
          dom.meta.textContent = 'CORS ou 404 sur /fixes';
          dom.grid.innerHTML = '';
          dom.empty.style.display = 'block';
          dom.empty.textContent = 'Scrape indisponible. Affichage de la liste via SteamTools ci-dessous.';
          const fb = document.getElementById('fallback');
          if (fb) fb.style.display = 'block';
          const fbf = document.getElementById('fallbackFrame');
          if (fbf) fbf.src = 'https://generator.ryuu.lol/fixes';
        }
      }

      dom.search.addEventListener('input', debounce(applySearch, 120));
      dom.refresh.addEventListener('click', load);

      load();
    })();
  </script>
</body>
</html>


