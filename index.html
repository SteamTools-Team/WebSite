<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SteamTools - T√©l√©chargement</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="fav.ico" type="image/x-icon" />
  
  <!-- Font Awesome pour les ic√¥nes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Meta tags SEO et r√©seaux sociaux -->
  <meta name="description" content="T√©l√©chargez SteamTools - L'outil ultime pour les passionn√©s de jeux Steam. Installation rapide, s√©curis√©e et gratuite.">
  <meta name="keywords" content="SteamTools, Steam, jeux, t√©l√©chargement, gaming, outils">
</head>
<body>
  <div class="container">
    <header>
      <a href="/" class="back-button">
        <i class="fas fa-arrow-left"></i> Retour
      </a>
      <h1>SteamTools</h1>
      <p class="subtitle">Installation rapide et s√©curis√©e</p>
      <div class="stats-info">
        <i class="fas fa-gamepad"></i>
        <span id="games-count">Chargement...</span> jeux disponibles
      </div>
    </header>

    <div class="file-info">
      <div class="file-icon">
        <img src="fav.ico" alt="Ic√¥ne SteamTools" />
      </div>
      <div class="file-details">
        <div class="file-name">SteamTools</div>
        <div class="file-meta">
          <span><i class="fas fa-weight-hanging"></i> 10.8 MB</span>
          <span><i class="fas fa-calendar-alt"></i> 07-08-2025</span>
          <span><i class="fas fa-shield-alt"></i> S√©curis√©</span>
        </div>
      </div>
    </div>

    <div class="download-options">
      <button class="download-button" id="local-download">
        <i class="fas fa-download download-icon"></i>
        T√©l√©charger la version installable
      </button>
      <a href="https://steamtools.ayka.dev/v/SteamTools.exe" class="download-button mirror-button" target="_blank" rel="noopener">
        <i class="fas fa-cloud-download-alt download-icon"></i>
        Lien miroir de sauvegarde
      </a>
    </div>

    <div class="old-versions">
      <h2><i class="fas fa-history"></i> Anciennes versions</h2>
      <div class="old-versions-grid">
        <a href="https://api.ayka.dev/SteamTools/SteamToolsV2.9.exe" class="old-download-button" target="_blank" rel="noopener">
          <i class="fas fa-download"></i> v2.9 (10.7 MB)
        </a>
        <a href="https://api.ayka.dev/SteamTools/SteamToolsV2.8.exe" class="old-download-button" target="_blank" rel="noopener">
          <i class="fas fa-download"></i> v2.8 (10.7 MB)
        </a>
        <a href="https://api.ayka.dev/SteamTools/SteamToolsV2.5.exe" class="old-download-button" target="_blank" rel="noopener">
          <i class="fas fa-download"></i> v2.5 (10.7 MB)
        </a>
        <a href="https://api.ayka.dev/SteamTools/SteamTools%20V2.exe" class="old-download-button" target="_blank" rel="noopener">
          <i class="fas fa-download"></i> v2.0 (9.15 MB)
        </a>
      </div>
    </div>

    <footer>
      <p>¬© 2025 SteamTools - D√©velopp√© par <strong>Ayka</strong></p>
      <p style="margin-top: 8px; font-size: 0.8rem;">
        <i class="fas fa-lock"></i> T√©l√©chargement s√©curis√© et v√©rifi√©
      </p>
    </footer>
  </div>

  <script>
    // üéØ FONCTION PRINCIPALE - D√©tecter automatiquement les jeux
    async function detectGamesCount() {
      const gamesCountElement = document.getElementById('games-count');
      gamesCountElement.innerHTML = '<i class="fas fa-spinner fa-pulse"></i>';
      
      console.log('üîç D√©but de la d√©tection automatique des jeux...');
      
      try {
        // üì¶ M√âTHODE 1: GitHub Contents API (recommand√©e)
        const count1 = await scanWithContentsAPI();
        if (count1 > 0) {
          console.log(`‚úÖ Contents API: ${count1} fichiers ZIP trouv√©s`);
          displayCount(count1);
          return;
        }

        // üå≥ M√âTHODE 2: GitHub Tree API (recursive)
        const count2 = await scanWithTreeAPI();
        if (count2 > 0) {
          console.log(`‚úÖ Tree API: ${count2} fichiers ZIP trouv√©s`);
          displayCount(count2);
          return;
        }

        // üîé M√âTHODE 3: GitHub Search API
        const count3 = await scanWithSearchAPI();
        if (count3 > 0) {
          console.log(`‚úÖ Search API: ${count3} fichiers ZIP trouv√©s`);
          displayCount(count3);
          return;
        }

        // ‚ùå FALLBACK: Aucune m√©thode n'a fonctionn√©
        throw new Error('Toutes les m√©thodes de d√©tection ont √©chou√©');

      } catch (error) {
        console.error('‚ùå Erreur de d√©tection:', error);
        gamesCountElement.textContent = '500+';
        gamesCountElement.style.opacity = '0.7';
      }
    }

    // üì¶ M√âTHODE 1: Scan avec Contents API
    async function scanWithContentsAPI() {
      try {
        const folders = ['', 'games', 'jeux', 'downloads', 'zips', 'files'];
        let totalCount = 0;
        
        for (const folder of folders) {
          const url = folder 
            ? `https://api.github.com/repos/ayka-667/SteamTools-WebSite/contents/${folder}`
            : 'https://api.github.com/repos/ayka-667/SteamTools-WebSite/contents';
            
          try {
            const response = await fetch(url);
            if (response.ok) {
              const data = await response.json();
              if (Array.isArray(data)) {
                const zipFiles = data.filter(file => 
                  file.type === 'file' && 
                  file.name.toLowerCase().endsWith('.zip')
                );
                totalCount += zipFiles.length;
                
                if (zipFiles.length > 0) {
                  console.log(`üìÅ ${folder || 'racine'}: ${zipFiles.length} fichiers ZIP`);
                  zipFiles.forEach(file => console.log(`  ‚Ä¢ ${file.name}`));
                }
              }
            }
          } catch (folderError) {
            console.warn(`‚ö†Ô∏è Dossier "${folder}" inaccessible:`, folderError.message);
          }
        }
        
        return totalCount;
      } catch (error) {
        console.error('‚ùå Contents API failed:', error);
        return 0;
      }
    }

    // üå≥ M√âTHODE 2: Scan avec Tree API
    async function scanWithTreeAPI() {
      try {
        // R√©cup√©rer les infos du repo
        const repoResponse = await fetch('https://api.github.com/repos/ayka-667/SteamTools-WebSite');
        if (!repoResponse.ok) throw new Error('Repo inaccessible');
        
        const repoData = await repoResponse.json();
        const branch = repoData.default_branch || 'main';
        
        // R√©cup√©rer l'arbre complet
        const treeResponse = await fetch(
          `https://api.github.com/repos/ayka-667/SteamTools-WebSite/git/trees/${branch}?recursive=1`
        );
        
        if (!treeResponse.ok) throw new Error('Tree API failed');
        
        const treeData = await treeResponse.json();
        
        // Filtrer les fichiers ZIP
        const zipFiles = treeData.tree.filter(item => 
          item.type === 'blob' && 
          item.path.toLowerCase().endsWith('.zip')
        );
        
        console.log('üå≥ Fichiers ZIP trouv√©s via Tree API:');
        zipFiles.forEach(file => console.log(`  ‚Ä¢ ${file.path}`));
        
        return zipFiles.length;
      } catch (error) {
        console.error('‚ùå Tree API failed:', error);
        return 0;
      }
    }

    // üîé M√âTHODE 3: Scan avec Search API
    async function scanWithSearchAPI() {
      try {
        const response = await fetch(
          'https://api.github.com/search/code?q=extension:zip+repo:ayka-667/SteamTools-WebSite'
        );
        
        if (!response.ok) throw new Error('Search API failed');
        
        const data = await response.json();
        
        console.log(`üîé Search API: ${data.total_count} r√©sultats trouv√©s`);
        
        if (data.items && data.items.length > 0) {
          console.log('üîé Fichiers trouv√©s via Search API:');
          data.items.forEach(item => console.log(`  ‚Ä¢ ${item.path}`));
        }
        
        return data.total_count || 0;
      } catch (error) {
        console.error('‚ùå Search API failed:', error);
        return 0;
      }
    }

    // üìä Afficher le nombre de jeux
    function displayCount(count) {
      const gamesCountElement = document.getElementById('games-count');
      
      if (count > 0) {
        // Animation du compteur
        let currentCount = 0;
        const increment = Math.ceil(count / 30);
        
        const countAnimation = setInterval(() => {
          currentCount += increment;
          if (currentCount >= count) {
            currentCount = count;
            clearInterval(countAnimation);
          }
          gamesCountElement.textContent = currentCount.toLocaleString('fr-FR');
        }, 50);
        
        // Style de succ√®s
        gamesCountElement.style.color = '#4caf50';
        setTimeout(() => {
          gamesCountElement.style.color = '';
        }, 2000);
        
      } else {
        gamesCountElement.textContent = '500+';
        gamesCountElement.style.opacity = '0.7';
      }
    }

    // üéÆ Gestionnaire de t√©l√©chargement
    document.getElementById('local-download').addEventListener('click', function(e) {
      e.preventDefault();
      
      if (this.classList.contains('downloading')) return;
      
      const originalContent = this.innerHTML;
      
      this.classList.add('downloading');
      this.innerHTML = '<div class="loading-spinner"></div> Pr√©paration...';
      
      setTimeout(() => {
        this.innerHTML = '<div class="loading-spinner"></div> T√©l√©chargement...';
        
        const link = document.createElement('a');
        link.href = 'https://api.ayka.dev/SteamTools/SteamTools.exe';
        link.download = 'SteamTools.exe';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        setTimeout(() => {
          this.classList.remove('downloading');
          this.classList.add('completed');
          this.innerHTML = '<i class="fas fa-check-circle"></i> Termin√© !';
          
          setTimeout(() => {
            this.classList.remove('completed');
            this.innerHTML = originalContent;
          }, 3000);
        }, 2000);
      }, 1000);
    });

    // üöÄ Initialisation
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üéÆ SteamTools - D√©tection automatique des jeux');
      detectGamesCount();
    });

    // üîÑ Mise √† jour automatique (toutes les 5 minutes)
    setInterval(() => {
      console.log('üîÑ Mise √† jour automatique du compteur...');
      detectGamesCount();
    }, 300000);
  </script>
</body>
</html>
